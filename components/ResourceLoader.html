<Loader isDone={loaded}>{#if loaded}<slot></slot>{/if}</Loader>

<script>
export default {
    data() {
        return {
            loaded: false,
            urls: [],
        };
    },

    components: {
        Loader: './Loader.html',
    },

    oncreate() {
        const { urls } = this.get();
        const js = [];
        const css = [];
        urls.forEach(url => {
            if (url.endsWith('.js')) {
                // The resource is a JavaScript file
                js.push(url);
            } else if (url.endsWith('.css') || url.startsWith('https://fonts.googleapis.com/')) {
                // The resource is a CSS file
                css.push(url);
            }
        });

        let numLoaded = 0;
        const total = css.length + js.length;
        const onLoaded = () => {
            if (numLoaded === total) {
                this.set({
                    loaded: true,
                });
            }
        };
        
        // Load CSS
        const head = document.querySelector('head');
        css.forEach(url => {
            const link = document.createElement('link');
            link.setAttribute('rel', 'stylesheet');
            link.setAttribute('href', url);
            link.addEventListener('load', () => {
                numLoaded++;
                onLoaded();
            });
            head.appendChild(link);
        });

        const loadScript = () => {
            if (js.length == 0) {
                onLoaded();
            } else {
                const script = document.createElement('script');
                script.onload = () => {
                    numLoaded++;
                    loadScript();
                };
                script.src = js.shift();
                head.appendChild(script);
            }
        };

        loadScript();
    }
}
</script>